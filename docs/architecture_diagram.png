graph TD
    subgraph "ðŸŸ¦ User Interface"
        A[CLI / FastAPI Server]
    end

    subgraph "ðŸŸ¨ Agent Core (src/agent)"
        B[TaskManagerAgent]
        C[Prompt Template]
        D{Parsing & Validation}
    end

    subgraph "ðŸŸ© External Services"
        E["Google Gemini LLM API"]
    end

    subgraph "ðŸŸª Storage & Data Models"
        F[ChromaDB Vector Store]
        G[LLMTaskSchema]
        H[Full 'Task' Model]
    end

    A -- "1. User Query (raw text)" --> B
    B -- "2. Format Prompt" --> C
    C -- "3. Complete Prompt" --> B
    B -- "4. Send to LLM" --> E
    E -- "5. Raw Output (string w/ Markdown)" --> B
    B -- "6. Sanitize & Parse" --> D
    D -- "7. Parsed Data" --> G
    B -- "8. Check for Duplicate (by title)" --> F
    F -- "9. Exists? (True/False)" --> B
    B -- "10. Upgrade to Full Model" --> H
    B -- "11. Save Task" --> F
    B -- "12. User Feedback (Success / Warning)" --> A
